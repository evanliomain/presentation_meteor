'use strict';

var _ = require('lodash');

var plugins = require('./');

module.exports = function multipipe() {
  if (arguments.length <= 1)
    return arguments[0];
  var args = _.toArray(arguments);
  var first = args.shift();
  var plexer;
  var last = _.reduce(args, function reduce(res, arg, i) {
    if (i !== args.length - 1) {
      arg.on('error', function onError(err) {
        plexer.emit('error', err);
      });
    }
    return res.pipe(arg);
  }, first);
  plexer = plugins.plexer({objectMode: true}, first, last);
  return plexer;
};
