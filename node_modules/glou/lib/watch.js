'use strict';

var _ = require('lodash');
var colorPath = require('color-path').colorize;
var gulp = require('gulp');

var $ = require('./plugins');

module.exports = function watch(options, sources, tasks) {
  if (_.isArray(options) || _.isString(options)) {
    tasks = sources;
    sources = options;
    options = {};
  }
  _.defaults(options, {debounceDelay: 100});

  if (!_.isArray(sources))
    sources = [sources];
  sources = _.filter(sources);

  if (!_.isArray(tasks))
    tasks = [tasks];

  gulp.watch(sources, options, function onChange(event) {
    $.log.warn('File ' + colorPath(event.path) + ' was ' + event.type + '!');
    _.each(tasks, function(task) {
      if (!gulp.tasks[task] || !gulp.tasks[task].fn || !gulp.tasks[task].fn.changed)
        gulp.start(task);
      else
        gulp.tasks[task].fn.changed(event);
    });
  });

  return this;
};
